defaults:
  - ../../../examples/config/traj_envs.yaml@_here_
  - ../../../examples/config/traj_envs_gem_games.yaml@_here_
  - ../../../examples/config/traj_envs_gem_rg.yaml@_here_

rollout_batch_size: 32
sequence_length: 8192
pretrain: Qwen/Qwen2.5-0.5B-Instruct

train_env_manager:
  format_penalty: -0.15 # sokoban env penalty_for_step=-0.1
  max_env_num_per_worker: 1
  num_env_groups: 1
  # under the same group, the env config and env seed are ensured to be equal
  group_size: 1
  tags: [SimpleSokoban]
  num_groups_partition: [1] # If not set, all env names divide nums equally. Under the same group, the env config and env seed (prompt) are equal in each generation
  llm_proxy:
    proxy_type: random
#  llm_proxy:
#    proxy_type: openai
#    proxy_config:
#      base_url: https://offline-whale-wave.alibaba-inc.com/api/v2/services/aigc/text-generation/v1/chat/completions
#      api_key: xxx
#      model_name: Qwen2.5-72B-Instruct-Chatflow

custom_envs:
  SimpleSokoban:
    ${custom_env.SimpleSokoban}
  FrozenLake:
    ${custom_env.FrozenLake}
  NaturalQuestions:
    ${custom_env.NaturalQuestions}
  GemGame:
    ${gem_games.Hangman}
  GSM_8k:
    ${custom_env.GSM_8k}
  CodeContest:
    ${custom_env.CodeContest}

actor_infer:
  generating_args:
    max_new_tokens: ${max_tokens_per_step} # single-turn response length
    top_p: 0.99
    top_k: 100
    num_beams: 1
    temperature: 0.99
    num_return_sequences: 1

max_tokens_per_step: 2048
max_actions_per_traj: 10

env_manager_cls: roll.pipeline.agentic.env_manager.traj_env_manager.TrajEnvManager
custom_env:
  SimpleSokoban:
    env_type: sokoban
    max_steps: ${max_actions_per_traj}
    max_tokens_per_step: ${max_tokens_per_step}
    env_manager_cls: ${env_manager_cls}
    use_thread_lock: true
    agent_system_template: ${agent_system_template}
    agent_template: ${agent_template}
    env_config: # keys should be a subset of SokobanConfig
      action_pattern: ${all_response_pattern}
      dim_room: [10, 10]
      num_boxes: 1
  FrozenLake:
    env_type: frozen_lake
    max_steps: ${max_actions_per_traj}
    max_tokens_per_step: ${max_tokens_per_step}
    env_manager_cls: ${env_manager_cls}
    use_thread_lock: true
    agent_system_template: ${agent_system_template}
    agent_template: ${agent_template}
    env_config:
      action_pattern: ${all_response_pattern}
      max_steps: ${max_actions_per_traj}
      is_slippery: false
  NaturalQuestions:
    env_type: "qa:NaturalQuestions"
    max_steps: ${max_actions_per_traj}
    max_tokens_per_step: ${max_tokens_per_step}
    env_manager_cls: ${env_manager_cls}
    agent_system_template: ${single_prompt_agent_system_template}
    agent_template: ${single_prompt_agent_template}
    env_config:
      max_steps: 10
      dataset_name: NaturalQuestions
    tool_wrapper:
      wrapper_args:
        tool_reward: 0.05
        tool_success_reward: 0.25
        max_tool_uses: 5
      tool_configs:
        - tool_id: search
          tool_args:
            search_url: http://localhost:8000/retrieve
            topk: 3
  GSM_8k:
    env_type: "math:GSM8K"
    max_steps: ${max_actions_per_traj}
    max_tokens_per_step: ${max_tokens_per_step}
    env_manager_cls: ${env_manager_cls}
    agent_system_template: ${single_prompt_agent_system_template}
    agent_template: ${single_prompt_agent_template}
    env_config:
      max_steps: 10
      dataset_name: GSM-8k
    tool_wrapper:
      wrapper_args:
        tool_reward: 0.05
        tool_success_reward: 0.25
        max_tool_uses: 5
      tool_configs:
#        - tool_id: python_code
#          tool_args:
#            timeout: 5
#            sandbox_type: none
#            keep_error_last_line: false
        - tool_id: mcp
          tool_args:
            server_url: xxx
  CodeContest:
    env_type: "code:CodeContest"
    max_steps: ${max_actions_per_traj}
    max_tokens_per_step: ${max_tokens_per_step}
    env_manager_cls: ${env_manager_cls}
    agent_system_template: ${single_prompt_agent_system_template}
    agent_template: ${single_prompt_agent_template}
    env_config:
      max_steps: 10
      dataset_name: CodeContest
    tool_wrapper:
      wrapper_args:
        tool_reward: 0.05
        tool_success_reward: 0.25
        max_tool_uses: 5
      tool_configs:
        - tool_id: python_code
          tool_args:
            timeout: 5
            sandbox_type: none
            keep_error_last_line: false
